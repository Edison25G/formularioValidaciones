<div class="min-h-screen flex flex-col lg:flex-row relative">
	<!-- Backdrop móvil -->
	<div
		*ngIf="menuOpen && isMobile"
		class="fixed inset-0 bg-black/30 backdrop-blur-md z-40 transition-opacity cursor-pointer"
		(click)="menuOpen = false"
		(keydown.enter)="menuOpen = false"
		(keydown.escape)="menuOpen = false"
		tabindex="0"
		role="button"
		aria-label="Cerrar menú"
	></div>

	<!-- Sidebar -->
	<aside
		class="w-60 bg-gray-900 text-white flex flex-col z-50 fixed inset-y-0 lg:static h-full lg:h-auto transform transition-transform duration-300 shadow-lg"
		[ngClass]="{ '-translate-x-full': !menuOpen && isMobile }"
	>
		<!-- Logo + cerrar -->
		<div class="flex items-center justify-between px-4 py-5 border-b border-gray-700">
			<div class="flex items-center gap-2">
				<img src="assets/img/docs.png" class="w-10 h-10" alt="Logo" />
				<span class="text-xl font-bold">Documentos</span>
			</div>
			<button class="lg:hidden text-white text-xl" (click)="menuOpen = false">
				<i class="pi pi-times"></i>
			</button>
		</div>

		<!-- Menú de navegación -->
		<div class="flex-1 overflow-y-auto">
			<p-tree
				[value]="menuItemsTree"
				selectionMode="single"
				(onNodeSelect)="navegar($event)"
				[style]="{ border: 'none', height: 'calc(100vh - 120px)', overflow: 'auto', backgroundColor: '#0F1E32FF' }"
				[filter]="true"
				filterPlaceholder="Buscar..."
			>
				<ng-template pTemplate="item" let-item>
					<ng-container *ngIf="!item.disabled; else deshabilitado">
						<a
							[routerLink]="item.routerLink"
							routerLinkActive="!text-green-400 bg-green-600/20 font-semibold"
							class="flex items-center gap-3 px-4 py-2 rounded transition-colors hover:bg-green-600/10 hover:text-green-400"
							(click)="menuOpen = false"
						>
							<i [class]="item.icon"></i>
							<span>{{ item.label }}</span>
						</a>
					</ng-container>

					<ng-template #deshabilitado>
						<div
							class="flex items-center gap-3 px-4 py-2 rounded text-gray-400 bg-gray-100 cursor-not-allowed opacity-50"
						>
							<i [class]="item.icon"></i>
							<span>{{ item.label }}</span>
						</div>
					</ng-template>
				</ng-template>
			</p-tree>
		</div>
	</aside>

	<!-- Contenido principal -->
	<div class="flex-1 flex flex-col bg-gray-50">
		<!-- Header -->
		<header class="bg-white px-6 py-4 flex justify-between items-center shadow sticky top-0 z-30">
			<div class="flex items-center gap-4">
				<button
					class="lg:hidden bg-green-100 p-3 rounded-full shadow-md border border-green-300 hover:bg-green-200 transition"
					(click)="menuOpen = !menuOpen"
				>
					<span class="block w-5 h-0.5 bg-green-800 mb-1 rounded"></span>
					<span class="block w-5 h-0.5 bg-green-800 mb-1 rounded"></span>
					<span class="block w-5 h-0.5 bg-green-800 rounded"></span>
				</button>
				<h2 class="text-xl font-bold">Gestor de Documentos</h2>
			</div>

			<div class="flex items-center gap-2 relative">
				<button type="button" (click)="op.toggle($event)">
					<img src="assets/img/user.png" class="w-10 h-10 rounded-full cursor-pointer" alt="User" />
				</button>

				<p-popover #op>
					<div class="text-sm space-y-2 w-40">
						<div class="text-center">
							<div class="font-bold text-gray-800">{{ user.username }}</div>
							<div class="text-xs text-green-600 bg-green-100 px-2 py-0.5 rounded-full inline-block mt-1">
								{{ user.role | titlecase }}
							</div>
						</div>
						<hr />
						<button
							(click)="logout()"
							class="w-full text-red-600 hover:underline text-sm flex items-center gap-2 justify-center"
						>
							<i class="pi pi-sign-out"></i> Cerrar sesión
						</button>
					</div>
				</p-popover>
			</div>
		</header>

		<main class="flex-1 p-0 overflow-y-auto">
			<router-outlet></router-outlet>
		</main>

		<amc-footer></amc-footer>
	</div>
</div>
