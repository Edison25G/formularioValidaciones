<p-toast></p-toast>

<div class="p-6 grid grid-cols-1 lg:grid-cols-2 gap-10">
	<!-- Columna Categoría Principal -->
	<div>
		<div class="mb-6 flex justify-between items-center">
			<h2 class="text-2xl font-bold text-gray-800">
				{{ editando ? 'Editar Categoría' : 'Crear Nueva Categoría' }}
			</h2>
			<p-button
				icon="pi pi-filter-slash"
				label="Limpiar"
				severity="secondary"
				outlined
				size="small"
				(click)="resetFormulario()"
			></p-button>
		</div>

		<form [formGroup]="formCategoria" (ngSubmit)="guardarCategoria()" class="space-y-6">
			<div>
				<span class="block text-sm font-semibold mb-1">Nombre</span>
				<input pInputText formControlName="name" class="w-full" placeholder="Ej. Ahorro" />
			</div>

			<div>
				<span class="block text-sm font-semibold mb-1">Slug</span>
				<input pInputText formControlName="slug" class="w-full" placeholder="Ej. ahorro" />
				<small class="text-gray-500">Usa letras minúsculas y guiones. Ej: plan-estrategico</small>
			</div>

			<div>
				<span class="block text-sm font-semibold mb-1">Ícono</span>
				<p-select
					[options]="iconosDisponibles"
					formControlName="icon"
					placeholder="Selecciona un ícono"
					optionLabel="label"
					optionValue="value"
					class="w-full"
					[filter]="true"
					[showClear]="true"
				>
					<ng-template let-option pTemplate="item">
						<div class="flex items-center gap-2">
							<i [class]="option.value"></i>
							<span>{{ option.label }}</span>
						</div>
					</ng-template>
				</p-select>
			</div>

			<div class="flex justify-end">
				<p-button
					type="submit"
					[label]="editando ? 'Actualizar Categoría' : 'Crear Categoría'"
					[icon]="editando ? 'pi pi-refresh' : 'pi pi-save'"
					class="p-button-success"
					[disabled]="formCategoria.invalid"
				></p-button>
			</div>
		</form>

		<div class="mt-10">
			<h3 class="text-xl font-semibold mb-4">Categorías existentes</h3>
			<p-table [value]="categoriasPadre" [paginator]="true" [rows]="5" responsiveLayout="scroll">
				<ng-template pTemplate="header">
					<tr>
						<th>Ícono</th>
						<th>Nombre</th>
						<th>Slug</th>
						<th class="text-center">Acciones</th>
					</tr>
				</ng-template>

				<ng-template pTemplate="body" let-cat>
					<tr>
						<td><i [class]="cat.icon"></i></td>
						<td>
							<strong>{{ cat.name }}</strong>
						</td>
						<td>{{ cat.slug }}</td>
						<td class="text-center space-x-2">
							<p-button icon="pi pi-pencil" rounded outlined size="small" (click)="editar(cat)"></p-button>
							<p-button
								icon="pi pi-trash"
								severity="danger"
								rounded
								outlined
								size="small"
								(click)="eliminar(cat)"
							></p-button>
						</td>
					</tr>
					<tr *ngFor="let sub of cat.subcategories">
						<td><i [class]="sub.icon"></i></td>
						<td style="padding-left: 2rem">- {{ sub.name }}</td>
						<td>{{ sub.slug }}</td>
						<td class="text-center space-x-2">
							<p-button icon="pi pi-pencil" rounded outlined size="small" (click)="editarSubcategoria(sub)"></p-button>
							<p-button
								icon="pi pi-trash"
								severity="danger"
								rounded
								outlined
								size="small"
								(click)="eliminarSubcategoria(sub)"
							></p-button>
						</td>
					</tr>
				</ng-template>
			</p-table>
		</div>
	</div>

	<!-- Columna Subcategoría -->
	<div>
		<div class="mb-6 flex justify-between items-center">
			<h2 class="text-2xl font-bold text-gray-800">
				{{ editandoSubcategoria ? 'Editar Subcategoría' : 'Crear Nueva Subcategoría' }}
			</h2>
			<p-button
				icon="pi pi-filter-slash"
				label="Limpiar"
				severity="secondary"
				outlined
				size="small"
				(click)="resetFormularioSubcategoria()"
			></p-button>
		</div>

		<form [formGroup]="formSubcategoria" (ngSubmit)="guardarSubcategoria()" class="space-y-6">
			<div>
				<span class="block text-sm font-semibold mb-1">Nombre</span>
				<input pInputText formControlName="name" class="w-full" placeholder="Ej. Inversiones" />
			</div>

			<div>
				<span class="block text-sm font-semibold mb-1">Slug</span>
				<input pInputText formControlName="slug" class="w-full" placeholder="Ej. inversiones" />
				<small class="text-gray-500">Usa letras minúsculas y guiones. Ej: inversiones</small>
			</div>

			<div>
				<span class="block text-sm font-semibold mb-1">Categoría Padre</span>
				<p-select
					[options]="categoriasPadre"
					formControlName="parent_id"
					optionLabel="name"
					optionValue="id"
					placeholder="Selecciona una categoría padre"
					class="w-full"
					[filter]="true"
					[showClear]="true"
				></p-select>
			</div>

			<div class="flex justify-end">
				<p-button
					type="submit"
					[label]="editandoSubcategoria ? 'Actualizar Subcategoría' : 'Crear Subcategoría'"
					[icon]="editandoSubcategoria ? 'pi pi-refresh' : 'pi pi-save'"
					class="p-button-success"
					[disabled]="formSubcategoria.invalid"
				></p-button>
			</div>
		</form>

		<div class="mt-10">
			<h3 class="text-xl font-semibold mb-4">Subcategorías existentes</h3>
			<p-table [value]="subCategorias" [paginator]="true" [rows]="5" responsiveLayout="scroll">
				<ng-template pTemplate="header">
					<tr>
						<th>Nombre</th>
						<th>Slug</th>
						<th>Categoría Padre</th>
						<th class="text-center">Acciones</th>
					</tr>
				</ng-template>

				<ng-template pTemplate="body" let-subcat>
					<tr>
						<td>{{ subcat.name }}</td>
						<td>{{ subcat.slug }}</td>
						<td>{{ getNombreCategoriaPadre(subcat.parent_id) }}</td>
						<td class="text-center space-x-2">
							<p-button
								icon="pi pi-pencil"
								rounded
								outlined
								size="small"
								(click)="editarSubcategoria(subcat)"
							></p-button>
							<p-button
								icon="pi pi-trash"
								severity="danger"
								rounded
								outlined
								size="small"
								pTooltip="Eliminar"
								tooltipPosition="top"
								(click)="eliminarSubcategoria(subcat)"
							></p-button>
						</td>
					</tr>
				</ng-template>
			</p-table>
		</div>
	</div>
</div>
